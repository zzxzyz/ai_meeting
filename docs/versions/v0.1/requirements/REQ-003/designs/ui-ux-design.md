# REQ-003: 实时音视频通话 - UI/UX 设计

## 文档信息

- **需求编号**: REQ-003
- **文档类型**: UI/UX 设计
- **创建日期**: 2026-02-26
- **更新日期**: 2026-02-26
- **设计人员**: Frontend Leader (UI/UX)
- **参考文档**: [需求分析](../analysis.md), [技术调研](../tech_research.md), [REQ-002 设计](../../REQ-002/designs/ui-ux-design.md)

---

## 1. 设计概述

### 1.1 设计目标

- **沉浸专注**: 视频内容占据核心区域，控制元素适时隐藏/显示
- **布局自适应**: 根据参与人数自动切换最优网格布局（1~4 路）
- **状态即时感知**: 网络质量、音视频状态一目了然
- **容错友好**: 连接异常、权限拒绝均有明确引导
- **风格一致**: 与 REQ-001/002 保持统一视觉语言

### 1.2 设计原则

1. **视频优先**: 视频区域最大化，UI 元素避免遮挡关键内容
2. **悬浮交互**: 控制栏默认 3 秒无操作后淡出，鼠标移动后恢复显示
3. **状态可见**: 静音、关摄像头、网络弱等状态叠加在对应视频格上
4. **渐进引导**: 首次进入时进行权限申请引导，异常时给出明确文案
5. **跨端一致**: Web 与 Electron 桌面端体验保持统一

---

## 2. 交互流程图

```
[会议管理页面 / 创建会议成功]
    │
    ▼
[权限检测]
    ├── 首次进入 ──► [权限申请弹窗：摄像头 + 麦克风]
    │                   ├── 允许 ──► [连接中界面]
    │                   └── 拒绝 ──► [权限被拒提示页] ──► 引导手动开启 ──► [重试]
    │
    └── 已授权 ──► [连接中界面（加载动画）]
                        │
                        ├── 连接成功 ──► [会议室主界面]
                        │                   │
                        │                   ├── 等待他人 ──► [单人等待状态（占位提示）]
                        │                   ├── 2人 ──► [左右各半布局]
                        │                   ├── 3人 ──► [1大+2小布局]
                        │                   └── 4人 ──► [2×2网格布局]
                        │
                        └── 连接失败 ──► [连接失败界面（错误提示 + 重试按钮）]
```

---

## 3. 页面设计

### 3.1 会议室主界面 — 4 人布局（2×2 网格）

#### 桌面端布局 (1280px+)

```
┌────────────────────────────────────────────────────────────┐
│  会议号：123-456-789          参与者：4 人         [14:32]  │
├──────────────────────────┬─────────────────────────────────┤
│                          │                                 │
│     [视频流：李四]        │       [视频流：王五]            │
│                          │                                 │
│  李四                🔇  │  王五                     🎥X  │
│                          │                                 │
├──────────────────────────┼─────────────────────────────────┤
│                          │                                 │
│     [视频流：赵六]        │       [视频流：预留]            │
│                          │                                 │
│  赵六            📶弱网  │                                 │
│                          │                                 │
└──────────────────────────┴─────────────────────────────────┘
│           [🎙️]    [📷]    [📞 结束通话]                    │
└────────────────────────────────────────────────────────────┘
                                          ┌─────────────┐
                                          │ [本地视频]  │
                                          │             │
                                          │  我（张三） │
                                          └─────────────┘
```

**说明**：
- 顶部栏：会议号、参与者数量、当前时间（或会议时长）
- 中央区域：远端参与者视频网格，每格叠加昵称、状态图标
- 右下角：本地视频预览小窗（可拖拽定位）
- 底部控制栏：麦克风、摄像头、结束通话（REQ-004 预留前两个）

---

### 3.2 会议室主界面 — 1 人布局（全屏单视频）

```
┌────────────────────────────────────────────────────────────┐
│  会议号：123-456-789          参与者：1 人         [00:12]  │
├────────────────────────────────────────────────────────────┤
│                                                            │
│                                                            │
│                   [视频流：李四]                           │
│                                                            │
│                 李四                  📶                   │
│                                                            │
│                                                            │
└────────────────────────────────────────────────────────────┘
│           [🎙️]    [📷]    [📞 结束通话]                    │
└────────────────────────────────────────────────────────────┘
                                          ┌─────────────┐
                                          │ [本地视频]  │
                                          │  我（张三） │
                                          └─────────────┘
```

---

### 3.3 会议室主界面 — 2 人布局（左右各半）

```
┌────────────────────────────────────────────────────────────┐
│  会议号：123-456-789          参与者：2 人         [05:32]  │
├──────────────────────────┬─────────────────────────────────┤
│                          │                                 │
│                          │                                 │
│     [视频流：李四]        │       [视频流：王五]            │
│                          │                                 │
│  李四                🔇  │  王五                      📶  │
│                          │                                 │
└──────────────────────────┴─────────────────────────────────┘
│           [🎙️]    [📷]    [📞 结束通话]                    │
└────────────────────────────────────────────────────────────┘
                                          ┌─────────────┐
                                          │ [本地视频]  │
                                          │  我（张三） │
                                          └─────────────┘
```

---

### 3.4 会议室主界面 — 3 人布局（1 大 + 2 小，主讲人模式）

```
┌────────────────────────────────────────────────────────────┐
│  会议号：123-456-789          参与者：3 人         [12:08]  │
├──────────────────────────────────┬─────────────────────────┤
│                                  │   [视频流：王五]        │
│                                  │  王五               📶 │
│      [视频流：李四（主讲）]       ├─────────────────────────┤
│                                  │   [视频流：赵六]        │
│  李四（主讲）             🔇     │  赵六              🎥X  │
└──────────────────────────────────┴─────────────────────────┘
│           [🎙️]    [📷]    [📞 结束通话]                    │
└────────────────────────────────────────────────────────────┘
                                          ┌─────────────┐
                                          │ [本地视频]  │
                                          │  我（张三） │
                                          └─────────────┘
```

**主讲人规则**：
- 当某参与者为最后加入的发言者（活跃音频流）时，自动成为主讲人占大格
- 用户可手动双击某视频格，将其固定为主讲人

---

### 3.5 视频格叠加元素

每个远端视频格右上角 / 左下角叠加以下元素：

```
┌──────────────────────────────┐
│                              │
│                              │
│       [视频流渲染区]          │
│                              │
│  昵称（截断20字）     [图标组] │
└──────────────────────────────┘
```

**图标组说明**：

| 图标 | 含义 | 显示条件 |
|------|------|---------|
| 🔇 | 对方已静音 | 对方麦克风关闭时 |
| 🎥X | 对方关闭摄像头 | 对方摄像头关闭时，视频格显示灰色头像占位 |
| 📶（弱） | 网络差 | 该路流质量评级为"差"时 |

**摄像头关闭时的视频格占位**：

```
┌──────────────────────────────┐
│                              │
│           ██████             │
│          ████████            │  ← 灰色用户头像居中
│           ██████             │
│                              │
│  王五                  🎥X   │
└──────────────────────────────┘
```

---

### 3.6 本地视频预览（右下角小窗）

```
                      ┌────────────────┐
                      │                │
                      │  [本地视频]    │
                      │                │
                      │  我（张三）    │
                      └────────────────┘
```

**规格**：
- 尺寸：160×90px（16:9，右下角固定）
- 可拖拽至屏幕四个角落
- 圆角 8px，轻阴影 `shadow-md`
- 本地麦克风静音时叠加 🔇 图标

---

### 3.7 顶部信息栏

```
┌────────────────────────────────────────────────────────────┐
│  会议号：123-456-789          参与者：4 人         [14:32]  │
└────────────────────────────────────────────────────────────┘
```

| 元素 | 位置 | 说明 |
|------|------|------|
| 会议号 | 左侧 | XXX-XXX-XXX 格式，点击复制 |
| 参与者数量 | 居中 | "参与者：N 人" |
| 会议时长 / 当前时间 | 右侧 | 从进入会议开始计时（HH:MM:SS） |

---

### 3.8 底部控制栏（REQ-004 预留）

```
┌────────────────────────────────────────────────────────────┐
│                                                            │
│           [🎙️ 麦克风]   [📷 摄像头]   [📞 结束通话]        │
│           （预留）        （预留）      （本期可用）         │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

**按钮说明**：

| 按钮 | 本期状态 | 样式 |
|------|---------|------|
| 麦克风 | 预留布局，不可交互（灰色） | 圆形按钮，图标 + 文字标签 |
| 摄像头 | 预留布局，不可交互（灰色） | 圆形按钮，图标 + 文字标签 |
| 结束通话 | 可交互（红色） | 圆形按钮，红底白图标 + "结束通话" |

**控制栏交互行为**：
- 默认可见
- 鼠标 3 秒无操作后淡出（`opacity: 0`，但仍可点击）
- 鼠标移入视频区域后恢复显示

---

## 4. 连接状态界面

### 4.1 连接中（加载动画）

```
┌────────────────────────────────────────────────────────────┐
│                                                            │
│                                                            │
│                   ◌ ◌ ◌（旋转动画）                       │
│                                                            │
│                  正在连接会议...                           │
│                  会议号：123-456-789                       │
│                                                            │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

**动画规格**：
- 三个圆点依次闪烁，循环间隔 400ms
- 背景色：`#111827`（深色）
- 文字色：`#F9FAFB`（白色）

---

### 4.2 连接失败

```
┌────────────────────────────────────────────────────────────┐
│                                                            │
│                                                            │
│                   ✕（红色大图标）                          │
│                                                            │
│                  连接失败                                  │
│                  无法连接到会议，请检查网络后重试            │
│                                                            │
│              ┌────────────────────────┐                   │
│              │       重新连接          │                   │
│              └────────────────────────┘                   │
│                                                            │
│                    返回首页                                │
└────────────────────────────────────────────────────────────┘
```

**错误文案规范**：

| 错误场景 | 提示文案 |
|---------|---------|
| 网络超时 | 连接超时，请检查网络设置后重试 |
| 会议不存在 | 该会议不存在或已结束 |
| 服务器错误 | 服务暂时不可用，请稍后重试 |
| ICE 协商失败 | 网络环境受限，无法建立连接 |

---

### 4.3 等待其他人加入（单人状态）

```
┌────────────────────────────────────────────────────────────┐
│  会议号：123-456-789          参与者：1 人         [00:00]  │
├────────────────────────────────────────────────────────────┤
│                                                            │
│                                                            │
│               ┌──────────────────────┐                    │
│               │                      │                    │
│               │  等待他人加入...     │                    │
│               │  分享会议号邀请对方   │                    │
│               │                      │                    │
│               │  [ 📋 复制会议号 ]   │                    │
│               │                      │                    │
│               └──────────────────────┘                    │
│                                                            │
└────────────────────────────────────────────────────────────┘
│           [🎙️]    [📷]    [📞 结束通话]                    │
└────────────────────────────────────────────────────────────┘
                                          ┌─────────────┐
                                          │ [本地视频]  │
                                          │  我（张三） │
                                          └─────────────┘
```

---

## 5. 网络质量指示器

### 5.1 信号格图标

每个视频格右下角显示网络质量信号格：

```
三格满格（好）：  ▄▄▄  （蓝色/绿色，全亮）
两格（中）：      ▄▄_  （黄色，前两格亮）
一格（差）：      ▄__  （红色，仅底格亮）
```

**颜色规范**：

| 等级 | 颜色 | 判断标准 |
|------|------|---------|
| 好 | `#16A34A`（绿色） | 延迟 < 150ms，丢包率 < 1% |
| 中 | `#D97706`（橙色） | 延迟 150~300ms，丢包率 1%~5% |
| 差 | `#DC2626`（红色） | 延迟 > 300ms，丢包率 > 5% |

### 5.2 悬浮提示

鼠标悬停在信号格图标上时显示 Tooltip：

```
┌─────────────────────────┐
│  网络质量：中            │
│  延迟：  187ms          │
│  丢包率：2.3%           │
│  码率：  1.2 Mbps       │
└─────────────────────────┘
```

**Tooltip 规格**：
- 背景：`#1F2937`（深灰），白色文字
- 位置：悬停目标上方，自动避边
- 圆角：6px，轻阴影

---

## 6. 弱网提示 Toast

当本地或远端网络质量降为"差"时，页面顶部弹出 Toast：

```
┌────────────────────────────────────────────────────────────┐
│  ⚠ 网络质量较差，视频质量已自动降低                    ✕  │
└────────────────────────────────────────────────────────────┘
```

**Toast 规格**：

| 属性 | 值 |
|------|---|
| 位置 | 页面顶部居中，悬浮于视频内容之上 |
| 背景色 | `#92400E`（深橙/棕色），白色文字 |
| 图标 | ⚠ 警告图标（橙色） |
| 自动消失 | 5 秒后自动消失；网络持续差时重复出现（60秒间隔） |
| 手动关闭 | 右侧 ✕ 按钮 |
| 圆角 | 8px，轻阴影 `shadow-md` |

**Toast 文案**：

| 场景 | 文案 |
|------|------|
| 本地弱网 | 网络质量较差，视频质量已自动降低 |
| 远端弱网 | 对方网络质量较差，视频可能出现卡顿 |
| 网络断开后重连 | 网络已恢复连接 |

---

## 7. 权限申请引导

### 7.1 首次进入会议权限申请弹窗

在浏览器 / Electron 发起权限申请前，先展示引导弹窗：

```
┌──────────────────────────────────────┐
│  允许使用摄像头和麦克风           ✕  │
├──────────────────────────────────────┤
│                                      │
│       📹  🎙️                         │
│                                      │
│  即将请求访问您的摄像头和麦克风，     │
│  用于音视频通话。                    │
│                                      │
│  请在浏览器弹窗中点击"允许"。         │
│                                      │
│  ┌───────────────────────────────┐  │
│  │          我知道了              │  │
│  └───────────────────────────────┘  │
└──────────────────────────────────────┘
```

### 7.2 权限被拒绝提示页

当用户拒绝权限后，展示友好的引导页面（全屏）：

```
┌────────────────────────────────────────────────────────────┐
│                                                            │
│                   🚫（红色禁止图标）                       │
│                                                            │
│               摄像头 / 麦克风权限被拒绝                    │
│                                                            │
│     需要访问您的摄像头和麦克风才能参与音视频通话。          │
│                                                            │
│     请按照以下步骤手动开启权限：                           │
│                                                            │
│     Chrome：地址栏左侧锁形图标 → 网站设置 → 允许           │
│     Safari：菜单栏"Safari" → 偏好设置 → 网站 → 摄像头/麦克风│
│     Edge：  地址栏左侧锁形图标 → 权限 → 允许               │
│                                                            │
│      ┌────────────────────┐  ┌───────────────────────┐   │
│      │   重新申请权限      │  │      返回首页          │   │
│      └────────────────────┘  └───────────────────────┘   │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

**注意**：Electron 端权限申请走系统级弹窗，拒绝后提示路径为系统设置（macOS：系统偏好设置 → 安全性与隐私）。

---

## 8. 组件规范

### 8.1 颜色规范

与 REQ-001/002 保持一致，会议室场景新增深色背景：

| 元素 | 颜色 | 说明 |
|------|------|------|
| 主色调 | `#2563EB`（蓝色） | 主要按钮、链接 |
| 会议室背景 | `#111827`（深灰近黑） | 视频会议沉浸感 |
| 视频格背景（无流） | `#1F2937` | 摄像头关闭占位 |
| 顶部/底部栏背景 | `rgba(0,0,0,0.6)` | 半透明覆盖层 |
| 控制栏图标 | `#F9FAFB`（白色） | 深色背景上的图标 |
| 结束通话按钮 | `#DC2626`（红色） | 危险操作 |
| 弱网信号（好） | `#16A34A`（绿色） | 信号格满格 |
| 弱网信号（中） | `#D97706`（橙色） | 信号格两格 |
| 弱网信号（差） | `#DC2626`（红色） | 信号格一格 |
| Toast 背景（警告） | `#92400E`（深橙） | 弱网提示 |

### 8.2 字体规范

| 元素 | 字号 | 字重 |
|------|------|------|
| 顶部会议号 | 14px | 500（等宽字体） |
| 视频格昵称 | 13px | 500 |
| 状态提示文字 | 16px | 500 |
| Toast 文字 | 14px | 400 |
| 按钮标签 | 12px | 500 |
| Tooltip 文字 | 12px | 400 |

### 8.3 视频格规范

| 属性 | 值 |
|------|---|
| 宽高比 | 16:9（强制保持） |
| 圆角 | 8px |
| 间距 | 8px（格与格之间） |
| 昵称叠加位置 | 左下角，半透明黑色渐变条 |
| 状态图标位置 | 右下角 |

### 8.4 本地预览小窗规范

| 属性 | 值 |
|------|---|
| 默认尺寸 | 160×90px |
| 默认位置 | 右下角，距边距 16px |
| 可拖拽范围 | 视口四个角落区域 |
| 圆角 | 8px |
| 阴影 | `shadow-md` |
| 层级 | `z-index: 50` |

### 8.5 按钮规范

沿用 REQ-001/002 规范，补充控制栏圆形按钮：

| 类型 | 样式 |
|------|------|
| 控制栏圆形按钮（激活） | 白色半透明背景，白色图标，圆形 48px |
| 控制栏圆形按钮（预留/禁用） | 灰色半透明背景，灰色图标，圆形 48px |
| 结束通话按钮 | 红色填充，白色图标，圆形 48px |
| 弹窗主要按钮 | 蓝色填充，白色文字，圆角 8px |
| 弹窗次要按钮 | 白色填充，蓝色边框/文字 |

---

## 9. 响应式设计

### 9.1 Web 端断点

| 断点 | 宽度 | 布局变化 |
|------|------|---------|
| 桌面大屏 | ≥ 1440px | 视频格间距 12px，控制栏按钮 56px |
| 桌面标准 | 1280px～1439px | 视频格间距 8px，控制栏按钮 48px |

### 9.2 Electron 桌面端

- 最小窗口尺寸：800px × 600px
- 视频网格自适应窗口大小，保持 16:9 宽高比
- 顶部导航栏与 Electron 原生窗口标题栏整合（无边框模式）
- 本地预览小窗随窗口大小等比缩放

### 9.3 移动端（延后至 v0.2）

- iOS / Android 原生 App 在 v0.2 实现
- 本期不需要适配移动端布局

---

## 10. 错误与空状态设计

### 10.1 视频流加载中

视频尚未渲染时，视频格显示加载占位：

```
┌──────────────────────────────┐
│                              │
│        ◌（旋转动画）         │
│        加载中...             │
│                              │
│  昵称                        │
└──────────────────────────────┘
```

### 10.2 全局错误状态

| 场景 | 展示方式 | 文案 |
|------|---------|------|
| 本地网络断开 | 顶部 Toast（红色） | 网络连接失败，正在尝试重连... |
| 重连成功 | 顶部 Toast（绿色） | 网络已恢复连接 |
| 会议已被创建者结束 | 全屏弹窗 | 会议已结束，感谢您的参与 |
| 被踢出会议 | 全屏弹窗 | 您已被移出会议 |

### 10.3 会议结束弹窗

```
┌──────────────────────────────────────┐
│  会议已结束                       ✕  │
├──────────────────────────────────────┤
│                                      │
│         ✅ 感谢您的参与！            │
│                                      │
│    会议时长：  32 分钟               │
│    参与人数：  4 人                   │
│                                      │
│  ┌───────────────────────────────┐  │
│  │          返回首页              │  │
│  └───────────────────────────────┘  │
└──────────────────────────────────────┘
```

---

## 11. 与 REQ-001/002 视觉一致性说明

| 设计要素 | REQ-001/002 规范 | REQ-003 处理方式 |
|---------|----------------|----------------|
| 主色调 | `#2563EB` 蓝色 | 按钮、链接沿用；会议室背景使用深色以衬托视频 |
| 输入框、弹窗 | 白色背景，圆角 8px | 权限引导弹窗、连接失败页面沿用相同弹窗规范 |
| 按钮样式 | 圆角 8px，主/次/危险三类 | 控制栏新增圆形按钮类型，样式与整体统一 |
| 错误提示 | `#EF4444` 红色，12px | 连接失败、权限拒绝沿用相同颜色规范 |
| Toast 通知 | 顶部居中，自动消失 5s | 弱网提示、网络恢复遵循相同行为规范 |
| 字体体系 | 14px 正文，12px 辅助 | 视频格叠加文字使用 13px，略小以减少遮挡 |
| 卡片阴影 | `rounded-lg shadow-sm` | 本地预览小窗使用 `rounded-lg shadow-md` |

---

## 12. 验收检查清单

- [ ] 1 人布局：全屏单视频正常显示，有"等待他人加入"提示
- [ ] 2 人布局：左右各半，比例正确
- [ ] 3 人布局：1 大 + 2 小，主讲人自动切换逻辑可感知
- [ ] 4 人布局：2×2 网格，间距均匀
- [ ] 视频格昵称叠加：超长昵称截断省略
- [ ] 静音图标：对方静音时正确显示 🔇
- [ ] 关摄像头：摄像头关闭时视频格显示灰色头像占位
- [ ] 本地预览小窗：默认右下角，可拖拽至四个角
- [ ] 顶部栏：会议号、参与者数量、时长正确显示
- [ ] 底部控制栏：麦克风/摄像头预留按钮为灰色不可交互，结束通话可用
- [ ] 控制栏淡出：3 秒无操作后淡出，鼠标移动后恢复
- [ ] 连接中动画：三点旋转动画正常显示
- [ ] 连接失败：错误提示 + 重新连接 + 返回首页按钮
- [ ] 权限申请弹窗：首次进入前展示引导
- [ ] 权限拒绝页：分浏览器说明引导步骤
- [ ] 网络质量信号格：三档颜色正确（绿/橙/红）
- [ ] 信号格 Tooltip：悬停显示延迟、丢包率、码率
- [ ] 弱网 Toast：网络差时顶部出现提示，5 秒后消失
- [ ] 会议结束弹窗：展示会议时长和参与人数
- [ ] Electron 最小窗口 800px：布局不错位
- [ ] 与 REQ-001/002 视觉风格保持一致

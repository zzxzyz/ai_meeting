# REQ-004 音视频控制功能 - UI/UX 设计

## 文档信息

- **需求编号**: REQ-004
- **需求名称**: 音视频控制功能
- **文档类型**: UI/UX 设计
- **版本**: v1.0
- **创建日期**: 2026-02-26
- **负责人**: frontend-leader
- **状态**: 草稿框架（待完善）
- **依赖**: REQ-003 UI/UX 设计、REQ-004 需求分析

---

## 1. 设计概述

### 1.1 设计目标

基于 REQ-003 已实现的音视频通话界面，为音视频控制功能提供直观、一致的用户体验：

- **操作直观性**：控制按钮状态清晰可见，操作反馈及时
- **状态可见性**：本地和远端状态一目了然，便于会议协调
- **一致性**：与 REQ-003 视觉风格和交互模式保持一致
- **无障碍性**：支持键盘操作和屏幕阅读器

### 1.2 设计原则

1. **状态优先**：音视频状态是会议中最关键的信息，需突出显示
2. **操作便捷**：常用控制功能一键可达，减少操作层级
3. **反馈及时**：操作后立即提供视觉/听觉反馈
4. **容错友好**：操作失败时有明确提示和恢复路径

### 1.3 设计范围

**本期设计范围**：
- 底部控制栏音视频控制按钮设计
- 视频格状态指示器设计
- 设备选择下拉菜单设计
- 状态变化动画和过渡效果

**后续版本设计**：
- 高级设备设置面板
- 状态快捷键设置
- 语音激活检测界面

---

## 2. 交互流程设计

### 2.1 麦克风控制流程

```
用户点击麦克风按钮
    ↓
按钮状态切换（静音/取消静音）
    ↓
本地图标状态变化 + 动画反馈
    ↓
发送控制指令到服务端
    ↓
服务端广播状态变化
    ↓
其他参会者视频格显示静音状态
    ↓
操作完成（< 100ms 延迟）
```

### 2.2 摄像头控制流程

```
用户点击摄像头按钮
    ↓
按钮状态切换（开启/关闭）
    ↓
本地预览切换（视频流/占位图）
    ↓
发送控制指令到服务端
    ↓
服务端广播状态变化
    ↓
其他参会者视频格显示摄像头状态
    ↓
操作完成（< 100ms 延迟）
```

### 2.3 设备切换流程

```
用户点击设备图标
    ↓
展开设备选择下拉菜单
    ↓
显示可用设备列表
    ↓
用户选择新设备
    ↓
切换设备，保持当前状态
    ↓
更新设备图标显示
    ↓
关闭下拉菜单
```

---

## 3. 界面设计规范

### 3.1 底部控制栏设计

#### 3.1.1 控制栏布局

**位置**：固定在页面底部，悬浮于视频内容之上

**布局结构**：
```
┌────────────────────────────────────────────────────────────┐
│           [🎤]    [📷]    [📞 结束通话]                    │
│          麦克风    摄像头     结束通话                     │
└────────────────────────────────────────────────────────────┘
```

**尺寸规范**：
- 高度：64px
- 背景：`rgba(0, 0, 0, 0.6)`（半透明黑色）
- 圆角：8px（仅顶部圆角）
- 边距：距离底部 16px，水平居中

#### 3.1.2 控制按钮设计

**麦克风按钮**：
- 默认状态：白色麦克风图标 `🎤` + "麦克风"标签
- 静音状态：红色静音图标 `🔇` + "已静音"标签
- 尺寸：48px × 48px（圆形按钮）
- 悬停效果：背景色 `rgba(255, 255, 255, 0.1)`
- 点击动画：缩放 0.95 倍，持续 150ms

**摄像头按钮**：
- 默认状态：白色摄像头图标 `📷` + "摄像头"标签
- 关闭状态：灰色带斜杠图标 `🎥✕` + "已关闭"标签
- 尺寸：48px × 48px（圆形按钮）
- 悬停效果：背景色 `rgba(255, 255, 255, 0.1)`
- 点击动画：缩放 0.95 倍，持续 150ms

**结束通话按钮**：
- 红色电话图标 `📞` + "结束通话"标签
- 尺寸：48px × 48px（圆形按钮）
- 背景：`#DC2626`（红色）
- 悬停效果：背景色 `#EF4444`（浅红）

### 3.2 视频格状态指示器

#### 3.2.1 状态指示器布局

**每个视频格右上角状态区**：
```
┌──────────────────────────────┐
│ [状态图标]                    │
│                              │
│         [视频流/占位]         │
│                              │
│  昵称                         │
└──────────────────────────────┘
```

**状态图标排列**（从右到左）：
1. 网络质量指示器（最右侧）
2. 摄像头状态指示器
3. 麦克风状态指示器

#### 3.2.2 状态图标设计

**麦克风状态图标**：
- 正常状态：不显示（默认）
- 静音状态：红色 `🔇` 图标（16px × 16px）
- 悬停提示："已静音"

**摄像头状态图标**：
- 正常状态：不显示（默认）
- 关闭状态：灰色 `🎥✕` 图标（16px × 16px）
- 悬停提示："摄像头已关闭"

**网络质量指示器**：
- 好：绿色三格 `📶`
- 中：黄色两格 `📶`
- 差：红色一格 `📶`
- 悬停提示：显示具体网络指标

### 3.3 设备选择下拉菜单

#### 3.3.1 下拉菜单设计

**触发方式**：点击设备图标展开

**菜单结构**：
```
┌─────────────────────────┐
│ 音频设备                │
│ ├─ 🔊 内置麦克风        │
│ ├─ 🎤 USB 麦克风        │
│ └─ 🎧 耳机麦克风        │
│                         │
│ 视频设备                │
│ ├─ 📷 内置摄像头        │
│ ├─ 📹 USB 摄像头        │
│ └─ 🖥️ 外接摄像头        │
└─────────────────────────┘
```

**菜单规格**：
- 宽度：200px
- 最大高度：300px（超出可滚动）
- 背景：`#1F2937`（深灰）
- 边框：1px solid `#374151`
- 圆角：8px
- 阴影：`shadow-lg`

#### 3.3.2 菜单项设计

**设备项**：
- 高度：40px
- 内边距：8px 12px
- 悬停背景：`#374151`
- 当前设备：左侧显示选中标记 `✓`
- 不可用设备：灰色文字，禁用点击

**分组标题**：
- 字体：12px，`#9CA3AF`（灰色）
- 内边距：8px 12px 4px
- 上边框：1px solid `#374151`（除第一个分组外）

### 3.4 本地预览窗口设计

#### 3.4.1 摄像头开启状态

**正常预览**：
- 显示实时视频流
- 16:9 宽高比
- 圆角：8px
- 边框：2px solid `#2563EB`（蓝色）

#### 3.4.2 摄像头关闭状态

**占位显示**：
```
┌─────────────────────────┐
│                         │
│        👤               │
│     用户头像             │
│                         │
│     我（张三）           │
└─────────────────────────┘
```

**占位规格**：
- 背景色：`#374151`（中灰）
- 用户头像：40px × 40px 圆形
- 头像颜色：根据用户 ID 哈希生成
- 昵称文字：14px，白色
- 边框：2px solid `#6B7280`（灰色）

---

## 4. 视觉设计规范

### 4.1 颜色规范

**主色调**（与 REQ-003 保持一致）：
- 主蓝色：`#2563EB`
- 成功绿色：`#16A34A`
- 警告橙色：`#D97706`
- 错误红色：`#DC2626`

**状态颜色**：
- 正常状态：白色 `#F9FAFB`
- 静音状态：红色 `#DC2626`
- 关闭状态：灰色 `#6B7280`
- 禁用状态：深灰 `#4B5563`

**背景色**：
- 控制栏背景：`rgba(0, 0, 0, 0.6)`
- 下拉菜单背景：`#1F2937`
- 视频格背景：`#111827`
- 占位背景：`#374151`

### 4.2 字体规范

**控制栏标签**：
- 字号：12px
- 字重：500（中等）
- 颜色：白色 `#F9FAFB`

**下拉菜单**：
- 设备名称：14px，字重 400
- 分组标题：12px，字重 500，灰色 `#9CA3AF`

**状态提示**：
- Tooltip：12px，字重 400
- 占位昵称：14px，字重 500

### 4.3 图标规范

**图标尺寸**：
- 控制按钮：24px × 24px
- 状态指示器：16px × 16px
- 设备图标：16px × 16px

**图标风格**：
- 使用系统原生 Emoji 图标
- 确保跨平台显示一致性
- 高对比度，确保可读性

### 4.4 动画规范

**按钮点击动画**：
```css
.button:active {
  transform: scale(0.95);
  transition: transform 150ms ease-in-out;
}
```

**状态切换动画**：
```css
.status-indicator {
  transition: all 200ms ease-in-out;
}
```

**下拉菜单动画**：
```css
.dropdown-menu {
  opacity: 0;
  transform: translateY(-10px);
  transition: opacity 200ms, transform 200ms;
}

.dropdown-menu.open {
  opacity: 1;
  transform: translateY(0);
}
```

---

## 5. 响应式设计

### 5.1 桌面端适配

**大屏（≥1440px）**：
- 控制栏按钮尺寸：56px × 56px
- 按钮间距：16px
- 字体大小：14px

**标准屏（1280px-1439px）**：
- 控制栏按钮尺寸：48px × 48px
- 按钮间距：12px
- 字体大小：12px

### 5.2 移动端适配（v0.2）

**横屏模式**：
- 控制栏移至右侧竖排
- 按钮尺寸缩小为 40px × 40px
- 简化标签显示

**竖屏模式**：
- 控制栏移至底部横排
- 自适应宽度，按钮等分
- 隐藏文字标签，仅显示图标

### 5.3 Electron 桌面端

**无边框模式**：
- 控制栏与窗口标题栏整合
- 保持与 Web 端一致的视觉风格
- 支持系统级拖拽区域

---

## 6. 无障碍设计

### 6.1 键盘导航

**Tab 键导航顺序**：
1. 麦克风按钮
2. 摄像头按钮
3. 设备选择按钮
4. 结束通话按钮

**键盘操作**：
- `Space` 或 `Enter`：激活当前焦点按钮
- `Esc`：关闭下拉菜单
- 方向键：在下拉菜单中导航

### 6.2 屏幕阅读器支持

**按钮语义**：
```html
<button
  aria-label="麦克风，当前状态：开启，点击静音"
  aria-pressed="false">
  <span class="sr-only">麦克风</span>
  <span aria-hidden="true">🎤</span>
</button>
```

**状态变化通知**：
```javascript
// 状态变化时通知屏幕阅读器
const liveRegion = document.getElementById('a11y-live-region');
liveRegion.textContent = '麦克风已静音';
```

### 6.3 颜色对比度

所有文本和图标确保 WCAG AA 标准：
- 正常文本：对比度 ≥ 4.5:1
- 大号文本：对比度 ≥ 3:1
- 用户界面组件：对比度 ≥ 3:1

---

## 7. 错误状态设计

### 7.1 操作失败提示

**Toast 提示**：
```
┌─────────────────────────────────────┐
| ⚠ 操作失败，请检查网络连接后重试     ✕ |
└─────────────────────────────────────┘
```

**规格**：
- 位置：顶部居中
- 背景：`#92400E`（深橙）
- 文字：白色
- 自动消失：5秒
- 手动关闭：点击 ✕ 按钮

### 7.2 权限拒绝状态

**设备权限被拒**：
- 控制按钮显示禁用状态（灰色）
- 悬停提示："需要麦克风权限，请在浏览器设置中开启"
- 点击时引导用户到权限设置页面

### 7.3 网络中断状态

**弱网指示**：
- 网络质量指示器显示红色一格
- 控制按钮增加半透明遮罩
- 悬停提示当前网络状况
- 操作失败时显示重试选项

---

## 8. 设计交付物

### 8.1 设计文件清单

**本期交付**：
- [ ] 控制栏组件设计稿（Figma/Sketch）
- [ ] 状态指示器设计规范
- [ ] 下拉菜单交互原型
- [ ] 动画效果说明文档
- [ ] 响应式布局规范

**设计资源**：
- 颜色变量定义（CSS Custom Properties）
- 图标资源包（SVG/PNG）
- 字体使用规范
- 组件间距系统

### 8.2 前端实现要点

**CSS 变量定义**：
```css
:root {
  --control-bar-height: 64px;
  --control-button-size: 48px;
  --status-indicator-size: 16px;
  --primary-blue: #2563EB;
  --error-red: #DC2626;
  --text-white: #F9FAFB;
}
```

**组件结构**：
```typescript
interface ControlBarProps {
  audioMuted: boolean;
  videoEnabled: boolean;
  onAudioToggle: () => void;
  onVideoToggle: () => void;
  onDeviceSelect: (device: MediaDeviceInfo) => void;
}
```

---

## 9. 与 REQ-003 设计一致性

### 9.1 视觉风格继承

**保持一致的元素**：
- 颜色体系（主蓝色、错误红色等）
- 字体规范（字重、大小、行高）
- 圆角半径（8px）
- 阴影效果（shadow-sm/md/lg）
- 动画时长（150ms/200ms）

### 9.2 交互模式延续

**复用模式**：
- 控制栏悬浮定位方式
- 按钮点击反馈动画
- Tooltip 显示逻辑
- 下拉菜单交互行为
- 错误提示 Toast 样式

### 9.3 组件复用策略

**可复用组件**：
- Button 组件（基础按钮样式）
- Icon 组件（图标统一管理）
- Tooltip 组件（提示信息）
- Dropdown 组件（下拉菜单）
- Toast 组件（操作反馈）

---

## 10. 测试验证要点

### 10.1 视觉验收标准

**颜色对比度**：
- [ ] 所有文本与背景对比度 ≥ 4.5:1
- [ ] 大号文本与背景对比度 ≥ 3:1
- [ ] 用户界面组件对比度 ≥ 3:1

**布局一致性**：
- [ ] 不同屏幕尺寸下布局正确
- [ ] 控制栏在不同浏览器中显示一致
- [ ] 图标在不同平台上显示清晰

### 10.2 交互验收标准

**操作反馈**：
- [ ] 按钮点击有视觉反馈
- [ ] 状态切换动画流畅
- [ ] 下拉菜单打开/关闭平滑
- [ ] 键盘导航顺序正确

**无障碍测试**：
- [ ] 屏幕阅读器能正确读取状态
- [ ] 键盘可以完全操作所有功能
- [ ] 焦点指示器清晰可见

---

## 11. 后续优化方向

### v0.2 设计增强

**高级控制界面**：
- 设备设置面板（音频输入/输出分离）
- 网络质量详细显示面板
- 状态快捷键自定义界面

**移动端优化**：
- 触摸友好的大按钮设计
- 手势控制（滑动静音等）
- 横竖屏自适应布局

### v0.3 智能功能

**语音激活界面**：
- 语音检测灵敏度设置
- 自动静音/取消静音状态指示
- 背景噪音过滤设置

**状态记忆界面**：
- 个人偏好设置面板
- 会议类型模板设置
- 设备场景记忆功能

---

## 12. 参考资料

- [REQ-003 UI/UX 设计文档](../REQ-003/designs/ui-ux-design.md)
- [REQ-004 需求分析文档](../analysis.md)
- [Web Content Accessibility Guidelines (WCAG) 2.1](https://www.w3.org/TR/WCAG21/)
- [Material Design 交互指南](https://material.io/design/interaction)

---

**文档状态**: 草稿框架（待 frontend-leader 完善）
**下一步**: 技术方案调研阶段（Task #109）
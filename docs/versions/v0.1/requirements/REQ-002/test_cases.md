# REQ-002 会议管理 - 测试用例文档

## 文档信息

- **需求编号**: REQ-002
- **需求名称**: 会议管理
- **文档类型**: 测试用例
- **版本**: v1.0
- **创建日期**: 2026-02-26
- **作者**: test-leader
- **状态**: 已完成

---

## 概述

本文档覆盖 REQ-002 会议管理功能的全部测试场景，包括：
- API 集成测试用例（后端接口）
- Web E2E 测试用例（前端交互）
- WebSocket 测试用例（实时通知）
- 边界条件与异常场景

---

## 测试环境

| 环境项 | 配置 |
|--------|------|
| 测试框架 | Jest 29 + Supertest（API 集成）、Playwright 1.40（E2E） |
| 后端服务 | NestJS（本地 http://localhost:3000） |
| 前端服务 | React（本地 http://localhost:5173） |
| 数据库 | PostgreSQL 15（Docker） |
| WebSocket | Socket.IO |
| Node.js | 20.x |

---

## 模块一：创建会议（POST /v1/meetings）

### TC-001: 已登录用户成功创建会议（带标题）

- **类型**: API 集成测试
- **优先级**: P0
- **前置条件**: 用户已注册并登录，持有有效 Access Token
- **输入**:
  ```json
  { "title": "产品评审会议" }
  ```
  Header: `Authorization: Bearer {access_token}`
- **预期结果**:
  - HTTP 状态码: 201
  - 响应体 `code = 0`
  - `data.meetingNumber` 为 9 位纯数字字符串
  - `data.status = "IN_PROGRESS"`
  - `data.creatorId` 等于当前用户 ID
  - `data.participantCount = 1`（创建者自动加入）
  - `data.startedAt` 为非空 ISO 时间字符串
- **验证点**: 会议号格式、状态、参与人数

---

### TC-002: 已登录用户成功创建会议（不带标题）

- **类型**: API 集成测试
- **优先级**: P0
- **前置条件**: 用户已登录
- **输入**: `{}` 或空请求体
- **预期结果**:
  - HTTP 状态码: 201
  - `data.title = null`
  - `data.meetingNumber` 符合 9 位数字格式

---

### TC-003: 未认证用户创建会议被拒绝

- **类型**: API 集成测试
- **优先级**: P0
- **前置条件**: 无 Token
- **输入**: `{ "title": "测试会议" }`，无 Authorization Header
- **预期结果**:
  - HTTP 状态码: 401
  - `code = 40101`

---

### TC-004: Token 过期时创建会议返回 401

- **类型**: API 集成测试
- **优先级**: P1
- **前置条件**: 使用已过期的 Access Token
- **预期结果**:
  - HTTP 状态码: 401
  - `code = 40102`

---

### TC-005: 创建会议标题超过 50 字符返回 400

- **类型**: API 集成测试
- **优先级**: P1
- **输入**: `{ "title": "超过五十个字符的超长会议标题测试超过五十个字符超过五十个字符" }`
- **预期结果**:
  - HTTP 状态码: 400

---

### TC-006: 同一用户可连续创建多个会议且会议号唯一

- **类型**: API 集成测试
- **优先级**: P0
- **步骤**: 连续调用创建接口 3 次
- **预期结果**: 3 次均成功，返回 3 个不同的会议号

---

### TC-007: Web 端一键创建会议流程

- **类型**: Web E2E 测试
- **优先级**: P0
- **前置条件**: 用户已登录
- **步骤**:
  1. 进入会议主页
  2. 点击"创建会议"按钮
  3. （可选）输入会议标题
  4. 确认创建
- **预期结果**:
  - 显示 9 位会议号（以 XXX-XXX-XXX 格式展示）
  - 提供复制会议号的功能
  - 会议状态显示"进行中"

---

## 模块二：加入会议（POST /v1/meetings/join）

### TC-008: 通过有效会议号成功加入会议

- **类型**: API 集成测试
- **优先级**: P0
- **前置条件**: 会议已存在且状态为 IN_PROGRESS，用户已登录
- **输入**: `{ "meetingNumber": "123456789" }`
- **预期结果**:
  - HTTP 状态码: 200
  - `code = 0`
  - `data.id` 为会议 UUID
  - `data.meetingNumber = "123456789"`
  - `data.status = "IN_PROGRESS"`
  - `data.participants` 为数组，包含创建者和当前用户
  - `data.durationSeconds` 为非负整数

---

### TC-009: 会议号不存在返回 404

- **类型**: API 集成测试
- **优先级**: P0
- **输入**: `{ "meetingNumber": "000000000" }`（不存在的会议号）
- **预期结果**:
  - HTTP 状态码: 404
  - `code = 40401`
  - `message` 包含友好提示文本

---

### TC-010: 会议号格式错误返回 400

- **类型**: API 集成测试
- **优先级**: P0
- **测试数据**:
  | 输入 | 说明 |
  |------|------|
  | `"12345678"` | 8 位（少一位） |
  | `"1234567890"` | 10 位（多一位） |
  | `"12345678a"` | 含字母 |
  | `"12345-6789"` | 含连字符 |
  | `""` | 空字符串 |
  | 未传 meetingNumber | 缺少必填字段 |
- **预期结果**: HTTP 400，`code = 40001` 或 `40002`

---

### TC-011: 加入已结束的会议返回 410

- **类型**: API 集成测试
- **优先级**: P0
- **前置条件**: 先创建并结束一个会议
- **输入**: `{ "meetingNumber": "{已结束会议号}" }`
- **预期结果**:
  - HTTP 状态码: 410
  - `code = 41001`
  - `message` 包含"已结束"相关提示

---

### TC-012: 重复加入同一会议（幂等性）

- **类型**: API 集成测试
- **优先级**: P1
- **步骤**: 同一用户对同一会议调用加入接口两次
- **预期结果**:
  - 两次均返回 200
  - 参与者列表中该用户不重复记录

---

### TC-013: 创建者加入自己创建的会议

- **类型**: API 集成测试
- **优先级**: P1
- **步骤**: 创建会议后，用同一用户调用加入接口
- **预期结果**:
  - 返回 200
  - `participants` 中创建者 `isCreator = true`

---

### TC-014: 未认证用户加入会议返回 401

- **类型**: API 集成测试
- **优先级**: P0
- **输入**: 无 Token
- **预期结果**: HTTP 401

---

### TC-015: Web 端输入有效会议号加入会议

- **类型**: Web E2E 测试
- **优先级**: P0
- **步骤**:
  1. 进入"加入会议"页面
  2. 输入有效 9 位会议号
  3. 点击"加入"按钮
- **预期结果**:
  - 成功进入会议室页面
  - 显示参与者列表

---

### TC-016: Web 端输入无效会议号时显示友好提示

- **类型**: Web E2E 测试
- **优先级**: P0
- **步骤**:
  1. 输入无效格式会议号（如 8 位）
  2. 点击"加入"
- **预期结果**: 页面显示格式错误提示，不发送请求

---

### TC-017: Web 端输入不存在会议号时显示友好提示

- **类型**: Web E2E 测试
- **优先级**: P0
- **步骤**:
  1. 输入不存在的 9 位会议号
  2. 点击"加入"
- **预期结果**: 显示"会议不存在"提示

---

### TC-018: Web 端加入已结束会议时显示友好提示

- **类型**: Web E2E 测试
- **优先级**: P0
- **预期结果**: 显示"该会议已结束"提示

---

## 模块三：查询会议列表（GET /v1/meetings）

### TC-019: 查询当前用户创建的会议列表（type=created）

- **类型**: API 集成测试
- **优先级**: P0
- **参数**: `?type=created&page=1&pageSize=10`
- **预期结果**:
  - HTTP 200
  - `data.items` 中所有会议的 `creatorId` 等于当前用户 ID
  - `data.total` 为非负整数
  - `data.page = 1`，`data.pageSize = 10`

---

### TC-020: 查询当前用户参与的会议列表（type=joined）

- **类型**: API 集成测试
- **优先级**: P0
- **参数**: `?type=joined&page=1&pageSize=10`
- **预期结果**:
  - HTTP 200
  - 返回用户以参与者身份加入的会议

---

### TC-021: 不传 type 返回全部相关会议

- **类型**: API 集成测试
- **优先级**: P1
- **参数**: `?page=1&pageSize=10`
- **预期结果**: HTTP 200，返回创建和参与的所有会议

---

### TC-022: 分页参数正确工作

- **类型**: API 集成测试
- **优先级**: P1
- **步骤**: 创建 15 个会议，分两页查询
- **参数第一页**: `?page=1&pageSize=10`
- **参数第二页**: `?page=2&pageSize=10`
- **预期结果**:
  - 第一页返回 10 条记录
  - 第二页返回 5 条记录
  - `total = 15`
  - 两页的 `id` 不重叠

---

### TC-023: 默认分页参数

- **类型**: API 集成测试
- **优先级**: P2
- **参数**: 不传 page 和 pageSize
- **预期结果**: 默认 page=1，pageSize=10

---

### TC-024: pageSize 超过 50 返回 400

- **类型**: API 集成测试
- **优先级**: P1
- **参数**: `?pageSize=51`
- **预期结果**: HTTP 400

---

### TC-025: page=0 返回 400

- **类型**: API 集成测试
- **优先级**: P1
- **参数**: `?page=0`
- **预期结果**: HTTP 400

---

### TC-026: 未认证请求列表返回 401

- **类型**: API 集成测试
- **优先级**: P0
- **预期结果**: HTTP 401

---

### TC-027: Web 端会议列表页面正确展示

- **类型**: Web E2E 测试
- **优先级**: P0
- **步骤**:
  1. 登录后进入会议列表页
  2. 切换"我创建的"和"我参与的" Tab
- **预期结果**:
  - 各 Tab 展示对应会议
  - 每条记录显示：会议号、会议状态、创建时间、参与人数
  - 状态标签正确（进行中/已结束）

---

## 模块四：查询会议详情（GET /v1/meetings/:meetingId）

### TC-028: 创建者查询自己会议的详情

- **类型**: API 集成测试
- **优先级**: P0
- **前置条件**: 用户创建了一个会议
- **预期结果**:
  - HTTP 200
  - 包含 `participants` 数组
  - 创建者记录的 `isCreator = true`
  - `durationSeconds` 为非负整数
  - 包含 `startedAt`、`creatorId` 等字段

---

### TC-029: 参与者查询会议详情

- **类型**: API 集成测试
- **优先级**: P0
- **前置条件**: 用户 B 已加入用户 A 创建的会议
- **步骤**: 用用户 B 的 Token 查询该会议详情
- **预期结果**:
  - HTTP 200
  - 返回完整会议信息

---

### TC-030: 非参与者查询会议详情返回 403

- **类型**: API 集成测试
- **优先级**: P0
- **前置条件**: 用户 C 未参与该会议
- **步骤**: 用用户 C 的 Token 查询该会议详情
- **预期结果**:
  - HTTP 403
  - `code = 40301`
  - `message` 包含"无权限"相关提示

---

### TC-031: 会议不存在返回 404

- **类型**: API 集成测试
- **优先级**: P0
- **参数**: 使用不存在的 meetingId（有效 UUID 格式）
- **预期结果**: HTTP 404，`code = 40401`

---

### TC-032: 已结束会议的详情可正常查询

- **类型**: API 集成测试
- **优先级**: P1
- **前置条件**: 会议已被结束
- **预期结果**:
  - HTTP 200
  - `status = "ENDED"`
  - `endedAt` 为非空时间字符串
  - `durationSeconds` 为正整数

---

### TC-033: 进行中会议的 durationSeconds 为实时值

- **类型**: API 集成测试
- **优先级**: P1
- **步骤**:
  1. 创建会议后等待 2 秒
  2. 查询会议详情
- **预期结果**: `durationSeconds >= 2`

---

### TC-034: 未认证请求详情返回 401

- **类型**: API 集成测试
- **优先级**: P0
- **预期结果**: HTTP 401

---

## 模块五：结束会议（POST /v1/meetings/:meetingId/end）

### TC-035: 会议创建者成功结束会议

- **类型**: API 集成测试
- **优先级**: P0
- **前置条件**: 用户是会议创建者，会议进行中
- **预期结果**:
  - HTTP 200
  - `code = 0`
  - `data.meetingId` 等于请求的会议 ID
  - `data.endedAt` 为 ISO 时间字符串
  - `data.durationSeconds` 为非负整数

---

### TC-036: 结束后再次查询会议状态为 ENDED

- **类型**: API 集成测试
- **优先级**: P0
- **步骤**:
  1. 创建者结束会议
  2. 查询会议详情
- **预期结果**: `status = "ENDED"`，`endedAt` 非空

---

### TC-037: 非创建者结束会议返回 403

- **类型**: API 集成测试
- **优先级**: P0
- **前置条件**: 用户 B 已加入会议，但不是创建者
- **步骤**: 用用户 B 的 Token 调用结束接口
- **预期结果**:
  - HTTP 403
  - `code = 40302`
  - `message` 包含"只有会议创建者"相关提示

---

### TC-038: 重复结束会议返回 409

- **类型**: API 集成测试
- **优先级**: P0
- **步骤**: 创建者结束会议后，再次调用结束接口
- **预期结果**:
  - HTTP 409
  - `code = 40901`
  - `message` 包含"已结束"相关提示

---

### TC-039: 结束不存在的会议返回 404

- **类型**: API 集成测试
- **优先级**: P1
- **参数**: 使用不存在的 meetingId
- **预期结果**: HTTP 404，`code = 40401`

---

### TC-040: 未认证用户结束会议返回 401

- **类型**: API 集成测试
- **优先级**: P0
- **预期结果**: HTTP 401

---

### TC-041: Web 端创建者点击结束会议按钮

- **类型**: Web E2E 测试
- **优先级**: P0
- **步骤**:
  1. 创建者进入会议详情页
  2. 点击"结束会议"按钮
  3. 确认弹窗
- **预期结果**:
  - 会议状态更新为"已结束"
  - "结束会议"按钮消失或变为不可点击
  - 显示成功提示

---

### TC-042: Web 端非创建者不显示结束会议按钮

- **类型**: Web E2E 测试
- **优先级**: P0
- **前置条件**: 用户 B 加入会议（非创建者）
- **预期结果**: 页面中无"结束会议"按钮

---

## 模块六：WebSocket 会议结束通知

### TC-043: 结束会议后所有在线参与者收到 meeting.ended 事件

- **类型**: API 集成测试（WebSocket）
- **优先级**: P0
- **步骤**:
  1. 用户 A 创建会议
  2. 用户 B 加入会议
  3. 用户 A 和用户 B 均通过 WebSocket 连接并加入会议房间（`join_meeting_room` 事件）
  4. 用户 A 调用结束会议接口
- **预期结果**:
  - 用户 B 收到 `meeting.ended` 事件
  - 事件数据包含：`meetingId`、`meetingNumber`、`endedBy`、`endedAt`、`durationSeconds`

---

### TC-044: 新参与者加入时在线用户收到 meeting.participant_joined 事件

- **类型**: API 集成测试（WebSocket）
- **优先级**: P1
- **步骤**:
  1. 用户 A 创建会议，通过 WebSocket 加入房间
  2. 用户 B 调用加入会议接口
- **预期结果**:
  - 用户 A 收到 `meeting.participant_joined` 事件
  - 事件数据包含：`meetingId`、`participant.userId`、`participant.nickname`

---

### TC-045: 未加入 WebSocket 房间的用户不收到会议通知

- **类型**: API 集成测试（WebSocket）
- **优先级**: P2
- **步骤**:
  1. 用户 C 已加入会议但未调用 `join_meeting_room`
  2. 创建者结束会议
- **预期结果**: 用户 C 不收到 `meeting.ended` 事件

---

## 模块七：端到端完整流程测试

### TC-046: 完整会议生命周期流程

- **类型**: E2E 集成测试
- **优先级**: P0
- **步骤**:
  1. 用户 A 注册并登录
  2. 用户 A 创建会议，获得会议号
  3. 用户 B 注册并登录
  4. 用户 B 使用会议号加入会议
  5. 验证会议详情包含两位参与者
  6. 用户 A 结束会议
  7. 验证会议状态变为 ENDED
  8. 用户 B 尝试加入已结束的会议
- **预期结果**:
  - 步骤 2: 返回有效 9 位会议号
  - 步骤 4: 成功加入，参与者数量为 2
  - 步骤 5: `participantCount = 2`，`participants` 长度为 2
  - 步骤 7: `status = "ENDED"`
  - 步骤 8: 返回 410

---

### TC-047: 创建-加入-查询-结束完整 Web 流程

- **类型**: Web E2E 测试
- **优先级**: P0
- **步骤**:
  1. 用户 A 登录，创建会议
  2. 复制会议号
  3. 用户 B 登录，通过会议号加入
  4. 用户 A 在会议列表查看会议信息
  5. 用户 A 结束会议
  6. 验证列表中会议状态更新

---

## 模块八：边界条件测试

### TC-048: 会议号格式边界验证

- **类型**: API 集成测试
- **优先级**: P1

| 输入 | 预期 HTTP | 预期 code |
|------|-----------|-----------|
| `"000000000"` | 200 或 404（取决于是否存在） | - |
| `"999999999"` | 200 或 404 | - |
| `"12345678"` | 400 | 40001/40002 |
| `"1234567890"` | 400 | 40001/40002 |
| `" 123456789"` | 400 | 40001/40002 |
| `"123456789 "` | 400 | 40001/40002 |
| `"123 456 789"` | 400 | 40001/40002 |

---

### TC-049: 并发多用户同时加入同一会议

- **类型**: 并发集成测试
- **优先级**: P1
- **步骤**: 10 个用户同时调用加入同一会议的接口
- **预期结果**:
  - 10 次请求均返回 200
  - 会议参与者数量最终为 11（含创建者）
  - 数据库中无重复参与者记录

---

### TC-050: 分页边界值

- **类型**: API 集成测试
- **优先级**: P2

| 参数 | 预期结果 |
|------|---------|
| `page=1&pageSize=1` | 返回 1 条记录 |
| `page=1&pageSize=50` | 返回最多 50 条 |
| `page=1&pageSize=51` | 400 错误 |
| `page=0` | 400 错误 |
| `page=-1` | 400 错误 |
| `pageSize=0` | 400 错误 |

---

### TC-051: 会议标题长度边界

- **类型**: API 集成测试
- **优先级**: P2

| 标题长度 | 预期结果 |
|---------|---------|
| 0 字符（空字符串） | 201，title 为 null 或空 |
| 50 字符（最大长度） | 201，成功创建 |
| 51 字符（超出限制） | 400 |

---

### TC-052: 无效 meetingId UUID 格式处理

- **类型**: API 集成测试
- **优先级**: P2
- **参数**: 使用非 UUID 格式的 meetingId（如 `abc`）
- **预期结果**: 400 或 404

---

### TC-053: 并发结束会议（幂等性）

- **类型**: 并发集成测试
- **优先级**: P2
- **步骤**: 创建者同时发送两个结束会议请求
- **预期结果**: 一个返回 200，另一个返回 409（先到先处理）

---

## 测试用例汇总

### 按模块统计

| 模块 | 用例数 | P0 | P1 | P2 |
|------|--------|----|----|-----|
| 创建会议 | 7 | 5 | 2 | 0 |
| 加入会议 | 11 | 7 | 3 | 1 |
| 查询会议列表 | 9 | 4 | 3 | 2 |
| 查询会议详情 | 7 | 4 | 2 | 1 |
| 结束会议 | 8 | 6 | 1 | 1 |
| WebSocket 通知 | 3 | 1 | 1 | 1 |
| 端到端完整流程 | 2 | 2 | 0 | 0 |
| 边界条件 | 6 | 0 | 3 | 3 |
| **总计** | **53** | **29** | **15** | **9** |

### 按类型统计

| 测试类型 | 用例数 |
|---------|--------|
| API 集成测试 | 36 |
| Web E2E 测试 | 11 |
| 并发测试 | 2 |
| WebSocket 测试 | 3 |
| E2E 完整流程 | 1 |
| **总计** | **53** |

---

## 验收标准覆盖矩阵

| 验收标准 | 覆盖的测试用例 |
|---------|---------------|
| 用户可成功创建会议并获得会议号 | TC-001, TC-002, TC-006, TC-007 |
| 用户可通过有效会议号加入会议 | TC-008, TC-012, TC-015 |
| 输入无效会议号时给出友好提示 | TC-009, TC-010, TC-016, TC-017, TC-018 |
| 会议列表正确显示 | TC-019, TC-020, TC-021, TC-022, TC-027 |
| 会议创建者可结束会议 | TC-035, TC-036, TC-041 |
| 会议结束后用户自动退出（WebSocket 通知） | TC-043 |
| 单元测试覆盖率 > 90% | （见单元测试文件） |

---

**文档版本**: v1.0
**创建日期**: 2026-02-26
**维护人**: test-leader

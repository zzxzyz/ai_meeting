# 团队协作指标计算说明

## 文档目的

本文档定义团队协作的关键指标及其计算方法,确保数据分析的一致性和准确性。

**适用范围**:
- 所有使用 Agent Team 协作模式的需求开发
- REQ-001、REQ-002、REQ-003 及后续需求
- 团队协作效率评估和改进

---

## 一、核心指标概览

### 1.1 指标分类

| 分类 | 核心指标 | 目标值 | 监控频率 |
|------|---------|-------|---------|
| **角色匹配度** | 角色匹配率 | >90% | 每个需求 |
| **任务效率** | 平均任务完成时间 | <30 分钟 | 每个需求 |
| **协作质量** | 任务重复率 | 0% | 每个需求 |
| **沟通效率** | 平均响应时间 | <15 分钟 | 每个需求 |
| **交付质量** | 代码测试覆盖率 | >80% | 每个需求 |

### 1.2 指标优先级

**P0 (关键指标)**: 必须达标,直接影响协作质量
- 角色匹配率
- 任务重复率
- 任务分配准确性

**P1 (重要指标)**: 应该优化,影响协作效率
- 平均任务完成时间
- 平均响应时间
- 任务状态同步及时性

**P2 (参考指标)**: 辅助分析,提供更多维度
- 并行任务数
- 代码复用率
- 消息数量

---

## 二、角色匹配度指标

### 2.1 角色匹配率

**定义**: 实际完成者角色与任务指定角色匹配的任务占总任务的比例。

**计算公式**:
```
角色匹配率 = (角色匹配任务数 / 总任务数) × 100%
```

**数据来源**:
- 角色匹配任务数: 统计任务记录中 "角色匹配" 列为 ✅ 的任务数
- 总任务数: 所有任务的数量

**示例计算**:
```
REQ-001 数据:
- 总任务数: 5
- 角色匹配任务数: 5
- 角色匹配率 = 5/5 × 100% = 100%
```

**目标值**: >90%

**判断标准**:
- ≥90%: ✅ 优秀,角色分工清晰
- 70%-89%: ⚠️ 合格,需要改进
- <70%: ❌ 不合格,存在严重的角色混淆问题

**改进建议**:
- <90%: 使用主动分配机制,不依赖 agents 自主领取
- <70%: 检查任务描述是否清晰,是否需要添加 `requiredRole` 字段

---

### 2.2 跨角色领取率

**定义**: 由非指定角色完成的任务占总任务的比例。

**计算公式**:
```
跨角色领取率 = (跨角色领取任务数 / 总任务数) × 100%
```

**数据来源**:
- 跨角色领取任务数: 统计任务记录中 "角色匹配" 列为 ❌ 的任务数
- 总任务数: 所有任务的数量

**关系**:
```
跨角色领取率 = 100% - 角色匹配率
```

**目标值**: <10%

**判断标准**:
- ≤10%: ✅ 优秀,偶尔跨角色可接受
- 11%-30%: ⚠️ 需要改进
- >30%: ❌ 严重问题

**跨角色原因分类**:
- 原角色忙碌: 指定角色当前有其他任务
- 技能要求: 任务需要特定技能,指定角色不具备
- 主动请求: agent 主动请求领取该任务
- 分配错误: team-lead 分配错误
- 其他

---

### 2.3 角色工作负载均衡度

**定义**: 衡量各角色工作量分配的均衡程度。

**计算公式**:
```
标准差 = sqrt(Σ(每个角色任务数 - 平均任务数)² / 角色数)
均衡度 = 1 - (标准差 / 平均任务数)
```

**数据来源**:
- 每个角色任务数: 统计每个角色完成的任务数
- 角色数: 参与该需求的角色总数

**示例计算**:
```
REQ-001 数据:
- product-manager: 2 任务
- architect: 2 任务
- backend-leader: 1 任务
- frontend-leader: 1 任务
- client-leader: 1 任务
- test-leader: 1 任务

平均任务数 = (2+2+1+1+1+1) / 6 = 1.33
标准差 = sqrt(((2-1.33)² + (2-1.33)² + (1-1.33)² + (1-1.33)² + (1-1.33)² + (1-1.33)²) / 6)
      = sqrt((0.45 + 0.45 + 0.11 + 0.11 + 0.11 + 0.11) / 6)
      = sqrt(1.34 / 6)
      = sqrt(0.22)
      = 0.47

均衡度 = 1 - (0.47 / 1.33) = 1 - 0.35 = 0.65 = 65%
```

**目标值**: >70%

**判断标准**:
- ≥80%: ✅ 非常均衡
- 70%-79%: ✅ 较均衡
- 50%-69%: ⚠️ 不够均衡
- <50%: ❌ 严重不均衡

---

## 三、任务效率指标

### 3.1 平均任务完成时间

**定义**: 所有任务从领取到完成的平均用时。

**计算公式**:
```
平均任务完成时间 = Σ(每个任务的用时) / 任务数
```

**数据来源**:
- 每个任务的用时 = 任务完成时间 - 任务领取时间
- 任务数: 已完成的任务总数 (status = completed)

**示例计算**:
```
REQ-001 数据:
- Task #1: 20 分钟
- Task #2: 25 分钟
- Task #3: 30 分钟
- Task #4: 15 分钟
- Task #5: 40 分钟

平均任务完成时间 = (20+25+30+15+40) / 5 = 26 分钟
```

**目标值**: <30 分钟

**判断标准**:
- ≤20 分钟: ✅ 非常高效
- 21-30 分钟: ✅ 高效
- 31-45 分钟: ⚠️ 一般
- >45 分钟: ❌ 效率低下

**注意事项**:
- 排除因阻塞导致的等待时间 (仅计算 in_progress 时间)
- 不同类型任务的合理用时差异较大,建议分类统计

---

### 3.2 任务完成时间分布

**定义**: 统计各时间段的任务数量分布。

**分类标准**:
- 快速任务: ≤15 分钟
- 正常任务: 16-30 分钟
- 复杂任务: 31-60 分钟
- 超长任务: >60 分钟

**计算方法**:
```
各类任务占比 = (该类任务数 / 总任务数) × 100%
```

**示例计算**:
```
REQ-001 数据:
- 快速任务 (≤15 分钟): 1 个 (Task #4) → 20%
- 正常任务 (16-30 分钟): 3 个 (Task #1, #2, #3) → 60%
- 复杂任务 (31-60 分钟): 1 个 (Task #5) → 20%
- 超长任务 (>60 分钟): 0 个 → 0%
```

**健康分布**:
- 快速任务: 20%-30%
- 正常任务: 50%-60%
- 复杂任务: 15%-25%
- 超长任务: <5%

**警示信号**:
- 超长任务 >10%: 任务粒度过大,需要拆分
- 快速任务 >50%: 任务粒度过小,可能过度分解

---

### 3.3 阶段完成时间

**定义**: 各开发阶段的用时统计。

**计算公式**:
```
阶段用时 = 该阶段最后一个任务完成时间 - 该阶段第一个任务开始时间
```

**数据来源**:
- 阶段1 (分析与设计): 需求分析、技术调研、API 契约、UI 设计等任务
- 阶段2 (实施): 后端、前端、客户端实现等任务
- 阶段3 (测试与部署): 集成测试、E2E 测试、部署等任务

**示例计算**:
```
REQ-001 数据:
- 阶段1: Task #1-#4
  - 开始时间: 2月13日 22:00
  - 结束时间: 2月13日 22:50
  - 用时: 50 分钟

- 阶段2: Task #5-#7
  - 开始时间: 2月13日 22:50
  - 结束时间: 2月13日 23:40
  - 用时: 50 分钟

- 阶段3: Task #8
  - 开始时间: 2月13日 23:40
  - 结束时间: 2月14日 00:00
  - 用时: 20 分钟
```

**健康比例**:
- 阶段1 (分析与设计): 30%-40%
- 阶段2 (实施): 40%-50%
- 阶段3 (测试与部署): 15%-25%

---

### 3.4 并行度

**定义**: 同时处于 in_progress 状态的任务数量。

**计算方法**:
- 最大并行度: 记录整个需求开发过程中同时 in_progress 的最大任务数
- 平均并行度: 计算整个开发过程的平均并行任务数

**计算公式**:
```
平均并行度 = Σ(每个时间点的 in_progress 任务数) / 时间点数
```

**数据来源**:
- 每隔 5-10 分钟记录一次当前 in_progress 的任务数
- 或在任务状态变化时记录

**示例计算**:
```
REQ-001 时间线:
- 22:00-22:30: 3 个任务并行 (Task #1, #2, #3)
- 22:30-22:50: 2 个任务并行 (Task #3, #4)
- 22:50-23:30: 3 个任务并行 (Task #5, #6, #7)
- 23:30-00:00: 1 个任务 (Task #8)

平均并行度 = (3×30 + 2×20 + 3×40 + 1×30) / 120
          = (90 + 40 + 120 + 30) / 120
          = 280 / 120
          = 2.33
```

**目标值**: 2-4 个

**判断标准**:
- 2-4 个: ✅ 理想的并行度
- 1 个: ⚠️ 串行开发,效率低
- >5 个: ⚠️ 可能存在资源浪费或任务粒度过小

---

## 四、协作质量指标

### 4.1 任务重复率

**定义**: 被多个 agents 重复领取的任务占总任务的比例。

**计算公式**:
```
任务重复率 = (重复领取任务数 / 总任务数) × 100%
```

**数据来源**:
- 重复领取任务数: 统计任务记录中 "重复领取次数" 列 >0 的任务数
- 总任务数: 所有任务的数量

**示例计算**:
```
REQ-001 数据:
- 总任务数: 5
- 重复领取任务数: 0
- 任务重复率 = 0/5 × 100% = 0%
```

**目标值**: 0%

**判断标准**:
- 0%: ✅ 完美,无任务冲突
- 1%-5%: ⚠️ 可接受,偶尔冲突
- >5%: ❌ 严重问题,需要任务锁机制

**重复原因分类**:
- 并发领取: 多个 agents 同时查看 TaskList 并领取
- 分配错误: team-lead 多次分配同一任务
- 状态不同步: 任务状态未及时更新导致重复领取

---

### 4.2 任务分配准确性

**定义**: 首次分配正确且无需重新分配的任务占总任务的比例。

**计算公式**:
```
任务分配准确性 = ((总任务数 - 重新分配次数) / 总任务数) × 100%
```

**数据来源**:
- 重新分配次数: 统计任务 owner 被修改的次数 (不包括首次分配)
- 总任务数: 所有任务的数量

**示例计算**:
```
REQ-001 数据:
- 总任务数: 5
- 重新分配次数: 0
- 任务分配准确性 = (5-0)/5 × 100% = 100%

反例 (REQ-002 假设):
- 总任务数: 8
- 重新分配次数: 2 (Task #3 被重新分配 1 次,Task #5 被重新分配 1 次)
- 任务分配准确性 = (8-2)/8 × 100% = 75%
```

**目标值**: 100%

**判断标准**:
- 100%: ✅ 完美分配
- 90%-99%: ✅ 优秀
- 80%-89%: ⚠️ 需要改进
- <80%: ❌ 分配机制存在问题

---

### 4.3 任务状态同步及时性

**定义**: 任务完成后及时更新状态的比例。

**计算公式**:
```
任务状态同步及时性 = (及时更新状态的任务数 / 总完成任务数) × 100%
```

**及时标准**:
- 任务实际完成后 5 分钟内更新状态为 completed

**数据来源**:
- 对比代码提交时间和任务状态更新时间
- 或对比 agent 完成通知时间和状态更新时间

**示例计算**:
```
REQ-001 数据:
- 总完成任务数: 5
- 及时更新状态的任务数: 3 (Task #1, #2, #4)
- 延迟更新的任务数: 2 (Task #3 延迟 15 分钟,Task #5 由 team-lead 手动更新)
- 任务状态同步及时性 = 3/5 × 100% = 60%
```

**目标值**: 100%

**判断标准**:
- 100%: ✅ 完美同步
- 80%-99%: ✅ 良好
- 60%-79%: ⚠️ 需要改进
- <60%: ❌ 严重不同步

**改进措施**:
- 在任务描述中明确提醒 agents 及时更新状态
- Team-lead 定期检查任务状态,发现延迟时主动询问

---

## 五、沟通效率指标

### 5.1 平均响应时间

**定义**: team-lead 响应 agent 消息的平均时间。

**计算公式**:
```
平均响应时间 = Σ(每条消息的响应时间) / 消息数
```

**数据来源**:
- 响应时间 = team-lead 回复时间 - agent 发送时间
- 消息数: 需要响应的 agent 消息数 (不包括通知类消息)

**示例计算**:
```
REQ-001 数据:
- 消息1: backend-leader 询问 API 契约 (22:30),team-lead 回复 (22:35) → 5 分钟
- 消息2: frontend-leader 报告阻塞 (23:00),team-lead 回复 (23:10) → 10 分钟
- 消息3: test-leader 询问测试范围 (23:30),team-lead 回复 (23:45) → 15 分钟

平均响应时间 = (5+10+15) / 3 = 10 分钟
```

**目标值**: <15 分钟

**判断标准**:
- ≤10 分钟: ✅ 非常及时
- 11-15 分钟: ✅ 及时
- 16-30 分钟: ⚠️ 略慢
- >30 分钟: ❌ 响应延误

---

### 5.2 消息数量

**定义**: 统计整个需求开发过程中的消息数量。

**分类统计**:
- Team-lead 发送消息数
- Agents 发送消息数
- 总消息数

**消息类型分布**:
- 任务分配通知
- 任务完成通知
- 问题询问
- 阻塞报告
- 进度更新
- 其他

**计算方法**:
```
各类消息占比 = (该类消息数 / 总消息数) × 100%
```

**健康分布**:
- 任务分配通知: 30%-40%
- 任务完成通知: 20%-30%
- 问题询问: 10%-20%
- 阻塞报告: 5%-10%
- 进度更新: 10%-20%

**警示信号**:
- 问题询问 >30%: 任务描述不够清晰
- 阻塞报告 >20%: 依赖关系设置有问题

---

### 5.3 沟通效率比

**定义**: 衡量沟通成本与任务数量的比例。

**计算公式**:
```
沟通效率比 = 总消息数 / 总任务数
```

**示例计算**:
```
REQ-001 数据:
- 总消息数: 20 条
- 总任务数: 5 个
- 沟通效率比 = 20 / 5 = 4
```

**目标值**: 3-5

**判断标准**:
- 3-5: ✅ 合理的沟通成本
- 2-2.9: ⚠️ 沟通不足,可能导致理解偏差
- 5.1-8: ⚠️ 沟通成本偏高
- >8: ❌ 沟通成本过高,需要优化

**改进建议**:
- 比值过低 (<3): 增加进度同步频率
- 比值过高 (>5): 优化任务描述,减少不必要的询问

---

## 六、交付质量指标

### 6.1 代码测试覆盖率

**定义**: 测试代码覆盖的源代码比例。

**计算公式**:
```
代码测试覆盖率 = (被测试覆盖的代码行数 / 总代码行数) × 100%
```

**数据来源**:
- 使用测试覆盖率工具 (如 Jest coverage, Istanbul 等) 自动生成报告

**示例**:
```
REQ-001 数据:
- 后端代码测试覆盖率: 87.5%
- 前端代码测试覆盖率: 未统计
```

**目标值**: >80%

**判断标准**:
- ≥90%: ✅ 优秀
- 80%-89%: ✅ 良好
- 70%-79%: ⚠️ 需要补充测试
- <70%: ❌ 测试不足

---

### 6.2 文档完整性

**定义**: 规定的文档是否全部输出。

**计算公式**:
```
文档完整性 = (已输出文档数 / 规定文档数) × 100%
```

**规定文档清单** (针对不同需求类型):
- **功能开发类**:
  1. 需求分析文档 (analysis.md)
  2. 技术调研文档 (tech_research.md)
  3. API 契约文档 (api_contract.md)
  4. UI/UX 设计文档 (ui-ux-design.md)
  5. 测试报告 (test_report.md)

- **技术优化类**:
  1. 优化方案文档
  2. 性能测试报告
  3. 对比分析文档

**示例计算**:
```
REQ-001 数据:
- 规定文档数: 5
- 已输出文档数: 5
- 文档完整性 = 5/5 × 100% = 100%
```

**目标值**: 100%

---

### 6.3 代码复用率

**定义**: 复用已有代码的比例。

**计算公式**:
```
代码复用率 = (复用的代码量 / 总代码量) × 100%
```

**示例**:
```
REQ-001 数据:
- Electron 端完全复用 Web 端代码
- 代码复用率: 100% (针对 Electron 端)
```

**目标值**: >80% (针对可复用场景)

**判断标准**:
- ≥90%: ✅ 优秀的架构设计
- 80%-89%: ✅ 良好
- 60%-79%: ⚠️ 有改进空间
- <60%: ⚠️ 可能存在重复代码

---

## 七、综合评估方法

### 7.1 综合评分模型

**总分**: 100 分

**权重分配**:
- 角色匹配度 (30 分)
  - 角色匹配率 (20 分): 匹配率 × 20
  - 跨角色领取率 (10 分): (1 - 跨角色率) × 10

- 任务效率 (25 分)
  - 平均任务完成时间 (15 分): 根据是否达标计分
  - 并行度 (10 分): 根据是否在理想范围计分

- 协作质量 (25 分)
  - 任务重复率 (10 分): (1 - 重复率) × 10
  - 任务分配准确性 (10 分): 准确性 × 10
  - 任务状态同步及时性 (5 分): 及时性 × 5

- 沟通效率 (10 分)
  - 平均响应时间 (10 分): 根据是否达标计分

- 交付质量 (10 分)
  - 代码测试覆盖率 (5 分): 覆盖率 × 5
  - 文档完整性 (5 分): 完整性 × 5

**示例计算**:
```
REQ-001 综合评分:
1. 角色匹配度: 100% × 20 + (1-0%) × 10 = 20 + 10 = 30 分
2. 任务效率: 15 (平均 26 分钟,达标) + 8 (并行度 2.33,理想) = 23 分
3. 协作质量: (1-0%) × 10 + 100% × 10 + 60% × 5 = 10 + 10 + 3 = 23 分
4. 沟通效率: 10 (平均响应 10 分钟,达标) = 10 分
5. 交付质量: 87.5% × 5 + 100% × 5 = 4.4 + 5 = 9.4 分

总分 = 30 + 23 + 23 + 10 + 9.4 = 95.4 分
```

**等级划分**:
- ≥90 分: A (优秀)
- 80-89 分: B (良好)
- 70-79 分: C (合格)
- 60-69 分: D (需要改进)
- <60 分: F (不合格)

---

### 7.2 对比分析方法

**纵向对比** (同一指标跨需求对比):
```
角色匹配率趋势:
- REQ-001: 100%
- REQ-002: 85%
- REQ-003: 92%

分析: REQ-002 实施流程改进后,REQ-003 的匹配率有所回升,说明改进有效。
```

**横向对比** (同一需求不同指标对比):
```
REQ-002 瓶颈分析:
- 角色匹配率: 85% (不达标)
- 平均任务完成时间: 28 分钟 (达标)
- 任务重复率: 5% (可接受)

分析: 主要问题在角色匹配,需要重点改进任务分配机制。
```

---

### 7.3 改进效果评估

**评估方法**:
1. 确定改进措施的目标指标
2. 记录改进前的基线数据
3. 实施改进措施
4. 记录改进后的数据
5. 计算改进幅度

**改进幅度计算**:
```
改进幅度 = ((改进后数值 - 改进前数值) / 改进前数值) × 100%
```

**示例**:
```
改进措施: 实施主动分配机制

目标指标: 角色匹配率

基线数据 (REQ-001):
- 角色匹配率: 80% (假设)

改进后数据 (REQ-002):
- 角色匹配率: 95%

改进幅度 = (95% - 80%) / 80% × 100% = 18.75%

结论: 主动分配机制使角色匹配率提升了 18.75%,改进有效。
```

---

## 八、数据收集指南

### 8.1 必须记录的数据点

**任务创建时**:
- [ ] 任务ID
- [ ] 任务名称
- [ ] 创建时间
- [ ] 指定角色

**任务领取时**:
- [ ] 实际领取者
- [ ] 领取时间
- [ ] 是否与指定角色匹配

**任务完成时**:
- [ ] 完成时间
- [ ] 用时
- [ ] 交付物路径

**发现问题时**:
- [ ] 问题类型
- [ ] 问题描述
- [ ] 影响任务
- [ ] 发现时间

**解决问题时**:
- [ ] 解决方案
- [ ] 解决时间

---

### 8.2 数据收集工具

**方法1: 手动记录** (当前方法)
- 使用模板文件记录: `collaboration_metrics_template.md`
- 定期更新数据

**方法2: 自动化脚本** (未来优化)
- 解析 TaskList 输出
- 解析 git 提交记录
- 解析 SendMessage 日志
- 自动生成数据报告

---

### 8.3 数据质量保证

**数据准确性**:
- 使用标准时间格式: YYYY-MM-DD HH:mm
- 统一角色名称 (不含 -2 等后缀)
- 及时记录,避免回忆偏差

**数据完整性**:
- 所有任务都必须记录
- 关键时间点不能遗漏

**数据一致性**:
- 同一指标在不同需求中使用相同计算方法
- 同一角色名称在不同记录中保持一致

---

## 九、指标使用建议

### 9.1 定期回顾

**频率**: 每完成一个需求后进行回顾

**步骤**:
1. 收集并整理数据
2. 计算所有关键指标
3. 对比目标值,识别不达标指标
4. 分析根本原因
5. 制定改进措施
6. 在下一需求中验证改进效果

---

### 9.2 趋势监控

**方法**: 绘制指标趋势图

**示例**:
```
角色匹配率趋势:
REQ-001: 100% ●━━━━━━━━━━━━━━━━━━━━●
REQ-002:  85% ●━━━━━━━━━━━━━━━●
REQ-003:  92% ●━━━━━━━━━━━━━━━━━●
REQ-004:  96% ●━━━━━━━━━━━━━━━━━━━●

趋势: 初期下降后持续上升,改进措施有效。
```

---

### 9.3 预警机制

**设置预警阈值**:
- 角色匹配率 <90%: 🔴 红色预警
- 任务重复率 >5%: 🟡 黄色预警
- 平均任务完成时间 >45 分钟: 🟡 黄色预警

**触发预警后的行动**:
1. 立即分析原因
2. 与团队沟通
3. 调整流程或工具
4. 持续监控改进效果

---

## 十、附录

### A. 指标快速查询表

| 指标名称 | 计算公式 | 目标值 | 数据来源 |
|---------|---------|-------|---------|
| 角色匹配率 | 匹配任务数 / 总任务数 × 100% | >90% | 任务记录表 |
| 任务重复率 | 重复任务数 / 总任务数 × 100% | 0% | 任务记录表 |
| 平均任务完成时间 | Σ用时 / 任务数 | <30分钟 | 任务记录表 |
| 平均响应时间 | Σ响应时间 / 消息数 | <15分钟 | 沟通记录表 |
| 代码测试覆盖率 | 覆盖行数 / 总行数 × 100% | >80% | 测试工具 |

---

### B. Excel 公式参考

如果使用 Excel 或 Google Sheets 记录数据,可以使用以下公式:

**角色匹配率**:
```excel
=COUNTIF(G2:G100,"✅")/COUNTA(G2:G100)*100
```
(G列为"角色匹配"列,统计✅的数量占比)

**平均任务完成时间**:
```excel
=AVERAGE(H2:H100)
```
(H列为"用时(分钟)"列)

**任务重复率**:
```excel
=COUNTIF(I2:I100,">0")/COUNTA(I2:I100)*100
```
(I列为"重复领取次数"列,统计大于0的数量占比)

---

### C. 可视化建议

**推荐图表类型**:
1. **角色匹配率趋势**: 折线图
2. **任务完成时间分布**: 直方图
3. **角色工作负载**: 条形图
4. **问题类型分布**: 饼图
5. **综合评分对比**: 雷达图

---

### D. 相关文档

- 协作数据记录模板: `docs/team_collaboration/collaboration_metrics_template.md`
- REQ-001 回顾分析: `docs/team_collaboration/REQ-001_retrospective.md`
- Team-Lead 工作流程: `docs/team_collaboration/team_lead_workflow.md`

---

**文档版本**: 1.0
**创建日期**: 2026-02-15
**创建者**: product-manager
**最后更新**: 2026-02-15
**适用范围**: 所有使用 Agent Team 协作模式的需求开发
